{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport { useContext } from \"react\";\nimport { useUser } from \"../../Components/User/User.hook\";\nimport { ConfigStateContext } from \"../../Contexts/Configurations/context\";\nimport Console from \"../../../lib/console\";\nimport { useTranslation } from \"react-i18next\";\nimport { useGoogleAnalytics } from \"./GoogleAnalytics.hook\";\nvar OneSignal;\nexport var useOneSignal = function useOneSignal() {\n  _s();\n\n  var _useContext = useContext(ConfigStateContext),\n      onesignal_configuration = _useContext.onesignal_configuration,\n      site_name = _useContext.site_name;\n\n  var _useTranslation = useTranslation(),\n      t = _useTranslation.t;\n\n  var GA = useGoogleAnalytics();\n\n  var _useUser = useUser(),\n      user = _useUser.user;\n\n  var IS_BROWSER = true;\n  return {\n    Init: function Init() {\n      if (IS_BROWSER && !window[\"OneSignal_INITIALIZED\"] && onesignal_configuration) {\n        OneSignal = window[\"OneSignal\"] || [];\n        OneSignal.push(function () {\n          OneSignal.init({\n            appId: onesignal_configuration.app_id,\n            allowLocalhostAsSecureOrigin: true,\n            autoRegister: true,\n            notifyButton: {\n              enable: false\n            },\n            promptOptions: {\n              actionMessage: t(\"Nos gustaría enviarte notificaciones de las últimas novedades!\"),\n              acceptButtonText: t(\"Aceptar\"),\n              cancelButtonText: t(\"No gracias\")\n            },\n            welcomeNotification: {\n              disable: true,\n              title: site_name,\n              message: t(\"Gracias por suscribirte!\")\n            }\n          })[\"catch\"](function (e) {\n            Console.warn(\"No se pudo initializar OneSignal\");\n            Console.log(e);\n          });\n        }); //guardar que accion tomó el usuario con prompt nativo de permisos del browser\n\n        OneSignal.push(function () {\n          OneSignal.on(\"notificationPermissionChange\", function (permissionChange) {\n            var currentPermission = permissionChange.to;\n            GA.Event({\n              action: \"WebPushNotifications\",\n              category: \"permissionChange\",\n              label: currentPermission\n            });\n          });\n        }); //trackeo cuando muestro prompt nativo del browser\n\n        OneSignal.push(function () {\n          OneSignal.on(\"permissionPromptDisplay\", function (event) {\n            GA.Event({\n              action: \"WebPushNotifications\",\n              category: \"showNativePromptPermission\"\n            });\n          });\n        }); // state check\n\n        if (user.data) {\n          OneSignal.push(function () {\n            OneSignal.isPushNotificationsEnabled(function (isEnabled) {\n              if (isEnabled) {\n                OneSignal.push(function () {\n                  //OneSignal.setEmail(midConfig.logged_email);\n                  OneSignal.sendTags({\n                    ic_user_id: user.data.me.id,\n                    nombreContacto: user.data.me.me.name,\n                    ic_email: user.data.me.me.email,\n                    ic_id_pais: user.data.me.me.country_id,\n                    particular: user.data.me.me.type\n                  });\n                });\n              }\n            });\n          });\n        }\n\n        window[\"OneSignal_INITIALIZED\"] = true;\n      }\n    }\n  };\n};\n\n_s(useOneSignal, \"JSRZfTojLbw6XdoJ/YLEKW4/rmg=\", false, function () {\n  return [useTranslation, useGoogleAnalytics, useUser];\n});","map":{"version":3,"sources":["/home/ansina/jsStuff/infocasas-landings/shared-components/GlobalHooks/web/OneSignal.hook.tsx"],"names":["useContext","useUser","ConfigStateContext","Console","useTranslation","useGoogleAnalytics","OneSignal","useOneSignal","onesignal_configuration","site_name","t","GA","user","IS_BROWSER","Init","window","push","init","appId","app_id","allowLocalhostAsSecureOrigin","autoRegister","notifyButton","enable","promptOptions","actionMessage","acceptButtonText","cancelButtonText","welcomeNotification","disable","title","message","e","warn","log","on","permissionChange","currentPermission","to","Event","action","category","label","event","data","isPushNotificationsEnabled","isEnabled","sendTags","ic_user_id","me","id","nombreContacto","name","ic_email","email","ic_id_pais","country_id","particular","type"],"mappings":"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","sourcesContent":["import { useContext } from \"react\";\nimport { useUser } from \"../../Components/User/User.hook\";\nimport { ConfigStateContext } from \"../../Contexts/Configurations/context\";\nimport Console from \"../../../lib/console\";\nimport { useTranslation } from \"react-i18next\";\nimport { useGoogleAnalytics } from \"./GoogleAnalytics.hook\";\n\nvar OneSignal;\nexport const useOneSignal = () => {\n\tconst {\n\t \tonesignal_configuration,\n\t \tsite_name,\n\t } = useContext(ConfigStateContext);\n\tconst { t } = useTranslation();\n\tconst GA = useGoogleAnalytics();\n\tconst { user } = useUser();\n\tconst IS_BROWSER = typeof window !== \"undefined\";\n\n\treturn {\n\t\tInit: () => {\n\t\t\tif (IS_BROWSER && !window[\"OneSignal_INITIALIZED\"] && onesignal_configuration) {\n\t\t\t\tOneSignal = window[\"OneSignal\"] || [];\n\n\t\t\t\tOneSignal.push(() => {\n\t\t\t\t\tOneSignal.init({\n\t\t\t\t\t\tappId: onesignal_configuration.app_id,\n\t\t\t\t\t\tallowLocalhostAsSecureOrigin: true,\n\t\t\t\t\t\tautoRegister: true,\n\t\t\t\t\t\tnotifyButton: { enable: false },\n\t\t\t\t\t\tpromptOptions: {\n\t\t\t\t\t\t\tactionMessage: t(\n\t\t\t\t\t\t\t\t\"Nos gustaría enviarte notificaciones de las últimas novedades!\"\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\tacceptButtonText: t(\"Aceptar\"),\n\t\t\t\t\t\t\tcancelButtonText: t(\"No gracias\"),\n\t\t\t\t\t\t},\n\t\t\t\t\t\twelcomeNotification: {\n\t\t\t\t\t\t\tdisable: true,\n\t\t\t\t\t\t\ttitle: site_name,\n\t\t\t\t\t\t\tmessage: t(\"Gracias por suscribirte!\"),\n\t\t\t\t\t\t},\n\t\t\t\t\t}).catch(e => {\n\t\t\t\t\t\tConsole.warn(\"No se pudo initializar OneSignal\");\n\t\t\t\t\t\tConsole.log(e);\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\t//guardar que accion tomó el usuario con prompt nativo de permisos del browser\n\t\t\t\tOneSignal.push(() => {\n\t\t\t\t\tOneSignal.on(\"notificationPermissionChange\", function(permissionChange) {\n\t\t\t\t\t\tvar currentPermission = permissionChange.to;\n\t\t\t\t\t\tGA.Event({\n\t\t\t\t\t\t\taction: \"WebPushNotifications\",\n\t\t\t\t\t\t\tcategory: \"permissionChange\",\n\t\t\t\t\t\t\tlabel: currentPermission,\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\t//trackeo cuando muestro prompt nativo del browser\n\t\t\t\tOneSignal.push(() => {\n\t\t\t\t\tOneSignal.on(\"permissionPromptDisplay\", function(event) {\n\t\t\t\t\t\tGA.Event({\n\t\t\t\t\t\t\taction: \"WebPushNotifications\",\n\t\t\t\t\t\t\tcategory: \"showNativePromptPermission\",\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\t// state check\n\t\t\t\tif (user.data) {\n\t\t\t\t\tOneSignal.push(function() {\n\t\t\t\t\t\tOneSignal.isPushNotificationsEnabled(function(isEnabled) {\n\t\t\t\t\t\t\tif (isEnabled) {\n\t\t\t\t\t\t\t\tOneSignal.push(function() {\n\t\t\t\t\t\t\t\t\t//OneSignal.setEmail(midConfig.logged_email);\n\t\t\t\t\t\t\t\t\tOneSignal.sendTags({\n\t\t\t\t\t\t\t\t\t\tic_user_id: user.data.me.id,\n\t\t\t\t\t\t\t\t\t\tnombreContacto: user.data.me.me.name,\n\t\t\t\t\t\t\t\t\t\tic_email: user.data.me.me.email,\n\t\t\t\t\t\t\t\t\t\tic_id_pais: user.data.me.me.country_id,\n\t\t\t\t\t\t\t\t\t\tparticular: user.data.me.me.type,\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\twindow[\"OneSignal_INITIALIZED\"] = true;\n\t\t\t}\n\t\t},\n\t};\n};\n"]},"metadata":{},"sourceType":"module"}